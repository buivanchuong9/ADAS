# ADAS System Configuration

# Sensor Calibration
sensor_calibration:
  camera:
    camera_matrix: |
      [[1000.0, 0, 960],
       [0, 1000.0, 540],
       [0, 0, 1]]
    distortion: [0.1, -0.2, 0, 0, 0]  # k1, k2, p1, p2, k3
    image_size: [1920, 1080]
    fps: 30
  
  lidar:
    channels: 32
    horizontal_resolution: 0.2  # degrees
    vertical_fov: [-25, 25]  # degrees
    max_range: 100  # meters
    fps: 10
  
  radar:
    range_resolution: 0.04  # meters
    doppler_resolution: 0.1  # m/s
    fps: 20
  
  # Extrinsic calibration (camera-lidar transform)
  extrinsics:
    camera_to_lidar:
      translation: [0.0, 0.0, 0.0]  # meters
      rotation: [0, 0, 0]  # Euler angles (rad)
    camera_to_radar:
      translation: [0.0, 0.0, 0.0]
      rotation: [0, 0, 0]

# Detection Models
detection:
  camera:
    model: "yolov8m"  # nano, small, medium, large, xlarge
    confidence_threshold: 0.5
    iou_threshold: 0.45
    classes: ["car", "truck", "bus", "person", "cyclist", "traffic_light", "stop_sign"]
  
  lidar:
    model: "pointpillars"  # or "centerpoint"
    confidence_threshold: 0.3
    max_detections: 100
  
  bev:
    model: "bevformer"
    grid_size: [200, 200]  # 20m x 20m at 0.1m resolution
    z_range: [0, 3]  # meters

# Tracking
tracking:
  max_age: 30  # frames
  min_hits: 3  # frames to confirm track
  iou_threshold: 0.3
  max_distance: 30  # pixels/points
  
  # Kalman Filter parameters
  kalman:
    process_noise: 0.01
    measurement_noise: 1.0
    initial_velocity_std: 0.1

# Prediction
prediction:
  horizon: 3.0  # seconds
  steps: 30  # prediction steps
  model: "lstm"  # or "transformer", "physics_based"
  
  physics_model:
    use_constant_velocity: true
    consider_acceleration: true
    max_deceleration: 10.0  # m/s^2

# Decision Logic (Safety Thresholds)
decision:
  fcw:
    ttc_threshold: 2.0  # Time to collision (seconds)
    min_confidence: 0.7
  
  aeb:
    ttc_threshold: 1.0  # Automatic emergency braking
    max_deceleration: 0.3  # g-units
    cooldown_period: 1.0  # seconds between triggers
  
  lka:
    lateral_offset_threshold: 0.2  # meters
    steering_angle_max: 25  # degrees
    enabled: false  # Set to true for lane-keeping
  
  bsd:  # Blind Spot Detection
    lateral_distance: 1.5  # meters
    follow_distance: 10.0  # meters

# Control
control:
  steering:
    max_angle: 450  # degrees
    max_rate: 90  # degrees/second
    latency: 0.1  # seconds
  
  braking:
    max_deceleration: 10.0  # m/s^2
    fail_safe_threshold: 0.5  # trigger emergency brake above this error
  
  throttle:
    max_acceleration: 3.0  # m/s^2

# ROS2 Parameters
ros2:
  node_name_prefix: "adas"
  qos_profile: "sensor_data"  # or "default"
  cycle_rate: 30  # Hz
  
  topics:
    camera_image: "/camera/image_raw"
    lidar_points: "/lidar/point_cloud"
    radar_objects: "/radar/objects"
    vehicle_state: "/vehicle/state"
    gps_fix: "/gps/fix"
    imu_data: "/imu/data"
    
    detection_camera: "/perception/camera/detections"
    detection_lidar: "/perception/lidar/detections"
    fusion_objects: "/fusion/objects"
    tracks: "/tracking/tracks"
    trajectories: "/prediction/trajectories"
    safety_state: "/decision/safety_state"
    control_command: "/control/command"

# Logging & Data Collection
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  data_dir: "./data/logs"
  record_rosbag: true
  rosbag_compression: "zstd"
  
  topics_to_log:
    - "/camera/image_raw"
    - "/lidar/point_cloud"
    - "/tracking/tracks"
    - "/decision/safety_state"
    - "/fusion/objects"

# Performance Optimization
optimization:
  use_tensorrt: true
  use_onnx: true
  quantization: "int8"  # none, int8, fp16
  
  batch_processing:
    camera_batch_size: 4
    lidar_batch_size: 1
  
  gpu_memory_fraction: 0.8

# Visualization
visualization:
  enable_rviz: true
  rviz_config: "deploy/rviz_config.rviz"
  enable_dashboard: true
  dashboard_port: 8888
